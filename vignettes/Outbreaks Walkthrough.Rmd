---
title: "Outbreaks Walkthrough"
output: 
  rmarkdown::html_vignette:
    toc: true
vignette: >
  %\VignetteIndexEntry{Outbreaks Walkthrough}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = FALSE
)
```

## Overview 

This page demonstrate use of the {sitrep} R Markdown template for analysis of an outbreak of Acute Jaundice Syndrome (AJS), using data from an outbreak in Am Timan, Chad. *This case study uses data that is not standardized with the MSF data dictionary, and so reflects a challenging use case.* 

### AJS/HEV outbreak in Am Timan, Chad (2016-2017)

We will be using data and examples from a real outbreak of Hepatitis E virus (HEV) infection which occurred in the Chadian town of Am Timan between October 2016 and April 2017  

*DISCLAIMER: The real data from the outbreak has been used for the training materials linked to the outbreak templates of the R4epis project. The Chadian Ministry of Health (MoH) has approved the use of this data for training purposes. Please note, that some data has been adapted in order to best achieve training objectives. Also, the GPS coordinates included in the dataset do not correspond to real cases identified during this outbreak. They have been generated exclusively for training purposes.*  

In early September 2016, a cluster of severely ill pregnant women with jaundice was detected at the Am Timan Hospital in the maternity ward. Following rapid tests conducted in Am Timan and confirmatory testing in the Netherlands, this was confirmed as due to HEV infection. Thus the MoH and MSF outbreak response was activated.  

The response consisted of four components:  

1) active community based surveillance (CBS)  
2) clinical assessment and management of ill cases at the hospital  
3) water chlorination activities at most water points in the town  
4) hygiene promotion  

**The outbreak linelist data was combined data from the active CBS data and the clinical data from the hospital.** The CBS functioned with community health workers visiting all households in the town every two weeks and actively searching for people with Acute Jaundice Syndrome (AJS). For this group of persons (suspected cases), only those that were visibly ill or that were pregnant were referred to the hospital for clinical assessment and admission if required. Persons that self-reported to the hospital or that arrived after referral would undergo a clinical assessment and a rapid test for HEV for diagnosis. Thus only for people assessed at the hospital were we able to capture a confirmed case status.  

For the duration of the outbreak we detected 1193 suspected cases, 100 confirmed cases and discarded 150 cases with AJS who were not positive for HEV infection.  

[Link to Spina and Lenglet *et al.* 2017](https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0188240)  









## Getting started

### Software installations  

To begin using R, ensure you have the following free software installed:  

1. R (the free statistical software)
2. RStudio (the free user interface)

If you are a new R user, we highly suggest doing the following:  

1. Complete our 5 free online introductory [R tutorials](www.appliedepi.org/tutorial). To begin, create your free Applied Epi account, as explained in the linked page
2. Review the [R basics chapter](https://epirhandbook.com/en/r-basics.html#r-basics) of our Epidemiologist R Handbook
3. Review the [Reports with R Markdown chapter](https://epirhandbook.com/en/reports-with-r-markdown.html) of the Epidemiologist R Handbook

Once you have an understanding of how R and RStudio work, know how to run basic commands, and have practiced running R code on your computer, you are ready to use our {sitrep} R Markdown templates to produce situation reports.  

### Install the {sitrep} R package

To access the templates, you must install the "sitrep" R package. R packages are often written in text with curly brackets, like: {sitrep}.  

1. Open RStudio
2. Run the following command in the R Console pane:  

```{r, eval=FALSE, echo=TRUE}
install.packages("remotes")
remotes::install_github("R4EPI/sitrep", dependencies = TRUE)
```

 
* Opening an outbreak or survey template  

**Access the final version of the RMarkdown script used in this walk-through**  
[Download the final RMarkdown template](/public_data/Final_casestudy_AJS_template.Rmd) used in this walk-through, to follow-along step-by-step  


### Open a new RStudio project

Working in R is best done from with an "RStudio project" that contains all the datasets, R scripts, and outputs for a single analytical project. 

You should review the Epidemiologist R Handbook chapters on [RStudio projects](https://epirhandbook.com/en/r-projects.html). Below are brief instructions on how to create a new RStudio project:  

>Select *File -> New Project* from the top RStudio menu.  

>Creating a new R project will create:  

>* A new project directory (folder)  
>* A R project file (.Rproj) in the project folder that serves as a shortcut to open the project via RStudio  

>Note:  

>* You can make sub-folders for data, scripts, etc.  
>* All files produced by R scripts saved to the project will also save into the project folder  
>* Navigate and open project files, such as scripts, using the Files tab of the lower-right RStudio pane.  
>*For an RMarkdown to produce the final report correctly, you must have read/write permissions for the location of the R project folder. On an MSF computer this is generally the c:/temp folder. 

One significant benefit of working within an R project is that all associated files (datasets, etc.) are located within the same folder. Thus, to send the project to someone else, **simply zip the folder and send**. All files referenced in the scripts are included and if you utilized the {here} package, no file paths are unique to your computer.  













## Open a {sitrep} R Markdown template

![This above gif shows how to open one of the templates, after having installed the {sitrep} R package](images/opening_template.gif){width="549"}





## Edit your template  


### Header

The very top of the template consists of a header surrounded by `---` lines. Here you may want to edit the title of your document. The other settings in the header define the default document type produced (Microsoft Word) when the RMarkdown is "knit".  

![](/images/AJS_Intro.png)

Remember that the green text below the header, located between these special characters (`<!--` and `-->`), is for your information only. This text will not appear in the final Word document report (see the R Basics page [Reading a RMarkdown](https://r4epis.netlify.com/training/r_basics/rmarkdown_orientation/) for more information).  




### Importing data


**In this template section you choose the appropriate code chunk to import your linelist dataset.** The linelist Excel file can be downloaded from the [case study overview](https://r4epis.netlify.com/training/walk-through/case_study_overview/) page.  

For this exercise our linelist dataset is a **non-DHIS file**, so to import we use the `read_nonDHIS_data` code chunk.  

**Comment out (using #) or delete the `read_fake_data`, `read_DHIS_data`, and `prep_DHIS_data` chunks**, as they are not necessary and will cause errors.

**Importing the dataset into R**  

Use the `import()` function of the **rio** package to import an Excel file that is not password protected. The `which=` argument of `import()` specifies that the sheet "linelist" should be imported.  

The `import()` function is wrapped around the `here()` function. The `here()` function makes it easy for R to locate files on your computer. It is best to save the dataset within an R project, and to provide `here()` with any R project subfolder names. **You can read more about `import()` and `here()` functions in the importing data R Basics page.**  



```{r eval=FALSE}
## Read data ------------------------------------
# Excel file
# to read in a specific sheet use "which"
#linelist_raw <- rio::import(here::here("AJS_AmTiman.xlsx"), which = "linelist")
```

A successfull import should result in a dataframe object named `linelist_raw` in your RStudio Environment pane, consisting of 1447 observations and 122 variables.  


```{r include=FALSE, results='hide', message=FALSE, warning=FALSE}
# This code chunk runs in the background and actually imports the dataset while transforming "." to NA.
# The import code chunk above (with eval=FALSE) does not run, but shows the viewer the default import code.
#linelist_raw <- rio::import("AJS_AmTiman.xlsx", which = "linelist", na=".")
```


```{r, include=FALSE, results='hide', message=FALSE, warning=FALSE}
# Save linelist_raw as "linelist_raw" for use in the next page (dataset alignment).
#saveRDS(linelist_raw, "data/linelist_raw.rds")
```
